{% extends "app/base.html" %}

{% block title %}{% endblock %}

{% block content %}
    {% load humanize %}
    <!-- Main Content -->
    <div class="large-8 columns" role="content">
      <article>
        <h3 id="video_title" video_id="{{ video_id }}">Loading...</h3>

        <small id="video_publish_date"></small>
        <div><small id="video_content"></small></div>
      </article>

      <hr />
      {% csrf_token %}

    {% if len_error %}
      <p>At least 10 classified spam and 10 classified ham are needed!</p>

    {% else %}
      <div id="comments">

        {% include "app/taggedComments.html" %}
        <h3>Prediction</h3>
        <hr/>

      {% for c, p in prediction %}
        <div class="comment row" tagType="automatic" comment_id="{{ c }}">
          <p class="content small-9 columns">{{ c }}</p>
          <div class="small-3 columns">
          {% if p %}
            <span class="comment_tag right tiny secondary button alert spam" disabled tag="spam">Spam</span>
            <span class="comment_tag right tiny secondary button ham" tag="ham">Ham</span>
          {% else %}
            <span class="comment_tag right tiny secondary button spam" tag="spam">Spam</span>
            <span class="comment_tag right tiny secondary button success ham" disabled tag="ham">Ham</span>
          {% endif %}
          </div>
        </div>
        <hr/>
      {% endfor %}
      </div>
      <a href id="moreComments" class="button expand secondary tiny loading-icon" disabled>Loading ...</a>

    {% endif %}
    </div>
    <!-- End Main Content -->

    <!-- Sidebar -->
    <aside class="large-4 columns">
      <div id="summary" class="panel">
        <h4>Summary</h4>
        <div>
          <strong># views:</strong> <span id="viewCount">0</span>
        </div>

        <div>
          <strong># comments:</strong> <span id="commentCount">0</span>
          <small>The actual count of comments may differ because, since November 2013, shares on Google+ are counted as comments.</small>
        </div>

        <div>
          <strong># classified comments:</strong>
          <span id="classifiedCount" value="{{ comments | length }}">{{ comments | length | intcomma }}</span>
        </div>

        <div>
          <strong># classified spam:</strong>
          <span id="spamCount" value="{{ spam_count }}">{{ spam_count | intcomma }}</span>
        </div>

        <div>
          <strong># classified ham:</strong>
          <span id="hamCount" value="{{ ham_count }}">{{ ham_count | intcomma }}</span>
        </div>
      {% if not len_error %}
        <div>
          <strong>Classifier:</strong>
          LinearSVC (c: {{ clf.get_params.C|floatformat:-5 }})
        </div>

        <div>
          <strong>Accuracy:</strong>
          {{ acc|floatformat:2 }}% &#177; {{ stddev|floatformat:2 }}
        </div>
      {% endif %}
        <a href="watch?v={{ video_id }}" class="button expand tiny">Back to video</a>

        <form id="export-form" action='/export' method="post">{% csrf_token %}
          <fieldset>
            <legend>Export Comments</legend>
            <input type="hidden" name="v" value="{{ video_id }}">
            <div id="export-comments"></div>

            <div class="row">
              <div class="small-1 large-2 columns">
                <input type="radio" name="export-option" value="m" id="m-radio" checked>
              </div>
              <div class="small-11 large-10 columns label-export">
                <label for="m-radio">Manually classified only</label>
              </div>
            </div>
            <div class="row">
              <div class="small-1 large-2 columns">
                <input type="radio" name="export-option" value="mu" id="mu-radio">
              </div>
              <div class="small-11 large-10 columns label-export">
                <label for="mu-radio">Manually classified and unclassified</label>
              </div>
            </div>
            <div class="row">
              <div class="small-1 large-2 columns">
                <input type="radio" name="export-option" value="ma" id="ma-radio">
              </div>
              <div class="small-11 large-10 columns label-export">
                <label for="ma-radio">Manually and automatically classified</label>
              </div>
            </div>
            <input type="submit" id="export-button" class="button tiny right" value="Export CSV">
          </fieldset>
        </form>
      </div>

    </aside>
    <!-- End Sidebar -->
{% endblock %}

{% block js %}
  <!-- JS (Placed at the end of the document so the pages load faster) -->
  {% load staticfiles %}
  <script src="{% static 'app/js/vendor/jquery.js' %}"></script>
  <script src="{% static 'app/js/vendor/jquery.cookie.js' %}"></script>
  <script src="{% static 'app/js/foundation.min.js' %}"></script>
  <script src="{% static 'app/js/classify.js' %}" type="text/javascript"></script>
{% endblock %}
